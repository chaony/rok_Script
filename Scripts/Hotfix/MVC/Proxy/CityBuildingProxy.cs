// =============================================================================== 
// Author              :    Gen By Tools
// Create Time         :    2019年12月5日
// Update Time         :    2019年12月5日
// Class Description   :    CityBuildingProxy
// Copyright IGG All rights reserved.
// ===============================================================================

using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Skyunion;
using Client;
using Data;
using SprotoTemp;
using System;
using System.Linq;
using PureMVC.Interfaces;
using SprotoType;

namespace Game {
    public class CityBuildingProxy : GameProxy {

        #region Member
        public const string ProxyNAME = "CityBuildingProxy";

        private PlayerProxy m_playerProxy;
        private BagProxy m_bagProxy;
        private WorkerProxy m_workerProxy;
        private bool m_ageChange;//玩家位置
        private bool m_lockMoveEvent;//迁城过程中设定城市不能点击和长按
        private Dictionary<long, GameObject> m_buildObjDic = new Dictionary<long, GameObject>();
        private Dictionary<long, CityObjData> OtherCityDic = new Dictionary<long, CityObjData>();
        private Dictionary<long, BuldingObjData> BuldingObjDataDic = new Dictionary<long, BuldingObjData>();
        private Dictionary<EnumCityBuildingType, Dictionary<long, BuldingObjData>> BuildingListByType = new Dictionary<EnumCityBuildingType, Dictionary<long, BuldingObjData>>();
        private Dictionary<long, BuildingInfoEntity> m_cityBuildingInfoDic = new Dictionary<long, BuildingInfoEntity>();
        private Dictionary<long, BuildingInfoEntity> m_maxBuildingInfoDic = new Dictionary<long, BuildingInfoEntity>();//类型，最高等级//TODO:
        private Dictionary<long, BuildingInfoEntity> m_minBuildingInfoDic = new Dictionary<long, BuildingInfoEntity>();//类型最低等级
        private Dictionary<long, int> m_maxCount = new Dictionary<long, int>();//最大建造数量
        private Dictionary<long, int> m_maxCountCurrentLevel = new Dictionary<long, int>();//当前等级最大建造数量
        private List<BuildingCountLimitDefine> m_buildingCountLimitList = new List<BuildingCountLimitDefine>();
        private List<BuildingLevelDataDefine> m_buildingLevelDataList = new List<BuildingLevelDataDefine>();
        private List<BuildingMenuDataDefine> m_BuildingMenuDataList = new List<BuildingMenuDataDefine>();
        private Dictionary<EnumAgeType, CityAgeSizeDefine> m_CityAgeSizeDic = new Dictionary<EnumAgeType, CityAgeSizeDefine>();
        private Dictionary<long, EnumAgeType> m_levelAgeDic = new Dictionary<long, EnumAgeType>();
        private Dictionary<EnumCityBuildingType, BuildingTypeConfigDefine> m_buildingTypeConfigDic = new Dictionary<EnumCityBuildingType, BuildingTypeConfigDefine>();
        private List<BuildingInfoEntity> m_cityBuildChangeList = new List<BuildingInfoEntity>();
        public bool m_isFirstGetBuildInfo = true;
        private List<PosInfo> HasBuildPos = new List<PosInfo>();
        private string m_followGameObject = string.Empty;
        private bool m_resetData = true;
        private long rid = 0;

        private static int[] size41 = new int[]{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,107,107,107,107,107,107,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,107,107,107,107,107,107,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,107,107,107,107,107,107,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,107,107,107,107,107,107,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,107,107,107,107,107,107,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,107,107,107,107,107,107,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,109,109,109,109,109,109,109,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,115,115,115,115,115,115,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,115,115,115,115,115,115,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,115,115,115,115,115,115,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,115,115,115,115,115,115,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,115,115,115,115,115,115,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,115,115,115,115,115,115,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,108,108,108,108,108,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,108,108,108,108,108,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,108,108,108,108,108,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5,5,5,108,108,108,108,108,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,108,108,108,108,108,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4};
        private static int[] size45 = new int[]{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,101,101,101,101,101,101,101,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4};
      //  private static int[] size47 = new int[] {4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4};
        private static int[] size49 = new int[]{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4};
        private static int[] size53 = new int[]{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4};
        private static int[] size57 = new int[]{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4};
      //  private static int[][] cityAgeSize = new int[][] {size41,size45, size47,size49, size53,size57};
        private static int[][] cityAgeSize = new int[][] {size41,size45,size49, size53,size57};

      //  private static int[] citySize = new int[] {41,45,47,49,53,57};
        private static int[] citySize = new int[] { 41, 45, 49, 53, 57 };
        //        private static int[][] cityAgeSize = new int[][] {size41,size45,size45,size45,size45};
        //
        //        private static int[] citySize = new int[] {41,45,45,45,45};
        private long m_buildPower;
        private const int MaxTownCenterLevel = 25;

        public int[] MakeCityMap()
        {
            int[] mapdata = GetCityMapSizeByAge();

            int[] clone = new int[mapdata.Length];

            var len = mapdata.Length;
            for (int i = 0; i < len; i++)
            {
                if (CityObjData.CITY_BUILDING_TYPE_OFFSET < mapdata[i])
                {
                    //大于100的还原 101 - 100 + 5
                    clone[i] = mapdata[i] - CityObjData.CITY_BUILDING_TYPE_OFFSET +
                               CityObjData.CITY_GRID_RESERVED_OFFSET;
                }
                else
                {
                    clone[i] = mapdata[i];
                }
            }

            return clone;
        }
        public int[] MakeCityMap(int age)
        {
            int[] mapdata = GetCityMapSizeByAge(age);

            int[] clone = new int[mapdata.Length];

            var len = mapdata.Length;
            for (int i = 0; i < len; i++)
            {
                if (CityObjData.CITY_BUILDING_TYPE_OFFSET < mapdata[i])
                {
                    //大于100的还原 101 - 100 + 5
                    clone[i] = mapdata[i] - CityObjData.CITY_BUILDING_TYPE_OFFSET +
                               CityObjData.CITY_GRID_RESERVED_OFFSET;
                }
                else
                {
                    clone[i] = mapdata[i];
                }
            }

            return clone;
        }

        public int[] MakeCityMapEmpty()
        {
            int[] data = MakeCityMap();
            var len = data.Length;
            for (int i = 0; i < len; i++)
            {
                //大于5的数据都还原为5
                if (CityObjData.CITY_GRID_RESERVED_OFFSET < data[i])
                {
                    data[i] = CityObjData.CITY_GRID_STATE_NORMAL;
                }
            }
            return data;
        }
        public int[] MakeCityMapEmpty(int age)
        {
            int[] data = MakeCityMap(age);
            var len = data.Length;
            for (int i = 0; i < len; i++)
            {
                //大于5的数据都还原为5
                if (CityObjData.CITY_GRID_RESERVED_OFFSET < data[i])
                {
                    data[i] = CityObjData.CITY_GRID_STATE_NORMAL;
                }
            }
            return data;
        }

        //获取内城大小
        public int GetCitySize(long level = 0)
        {
            return citySize[(int) GetAgeType(level) -1];
        }

        //获取内城加外墙大小
        public int GetCityOutSize()
        {
            return GetCitySize() + 2;
        }

        public Dictionary<long, BuildingInfoEntity> CityBuildingInfoDic
        {
            get
            {
                return m_cityBuildingInfoDic;
            }
        }
        /// <summary>
        /// 总建筑战力
        /// </summary>
        /// <returns></returns>
        public long BuildPower()
        {
            long v = 0;
            if (m_cityBuildingInfoDic!=null)
            {
                foreach (var buildingType in m_cityBuildingInfoDic)
                {
                    if (buildingType.Value!=null)
                    {
                        BuildingLevelDataDefine buildingLevelDataDefine = BuildingLevelDataBylevel(buildingType.Value.type, buildingType.Value.level);
                        if (buildingLevelDataDefine != null)
                        {
                            v += buildingLevelDataDefine.power;
                        }
                    }
                }
            }
            return v;
        }

        //获取建筑配置
        public BuildingTypeConfigDefine GetBuildConfig(EnumCityBuildingType type)
        {
            return m_buildingTypeConfigDic[type];
        }

        public Vector2 RolePos
        {
            get
            {
                if (MyCityObjData == null)
                {
                    return Vector2.zero;
                }
                else
                {
                    Vector2 pos = new Vector2();
                    pos.x = MyCityObjData.pos.x;
                    pos.y = MyCityObjData.pos.y;
                    return pos;
                }
            }
        }

        public string FollowGameObject
        {
            get
            {
                return m_followGameObject;
            }

            set
            {
                m_followGameObject = value;
            }
        }
        /// <summary>
        /// 
        /// </summary>
        private void RefreshData(BuildingInfoEntity buildingInfo)
        {
            if (!m_maxBuildingInfoDic.ContainsKey(buildingInfo.type))
            {
                m_maxBuildingInfoDic.Add(buildingInfo.type, buildingInfo);
            }
            else
            {
                if (m_maxBuildingInfoDic[buildingInfo.type].level < buildingInfo.level)
                {
                    m_maxBuildingInfoDic[buildingInfo.type] = buildingInfo;
                }
            }

            if (!m_minBuildingInfoDic.ContainsKey(buildingInfo.type))
            {
                m_minBuildingInfoDic.Add(buildingInfo.type, buildingInfo);
            }
            else
            {
                if (m_minBuildingInfoDic[buildingInfo.type].level > buildingInfo.level)
                {
                    m_minBuildingInfoDic[buildingInfo.type] = buildingInfo;
                }
            }
            if (!BuldingObjDataDic.ContainsKey(buildingInfo.buildingIndex))
            {
                BuldingObjData BuldingObjData = new BuldingObjData();
                BuldingObjData.index = buildingInfo.buildingIndex;
                BuldingObjData.assetReady = false;
                if (m_buildingTypeConfigDic.ContainsKey((EnumCityBuildingType)buildingInfo.type))
                {
                    BuldingObjData.SetBuildingTypeConfig (m_buildingTypeConfigDic[(EnumCityBuildingType)buildingInfo.type]);
                    BuldingObjData.SetBuildingInfoEntity(buildingInfo);
                    BuldingObjData.SetBuildingLevelData(BuildingLevelDataBylevel(buildingInfo.type, buildingInfo.level));
                }
                MyCityObjData.AddBuilding(BuldingObjData);
                if (m_buildObjDic.ContainsKey(buildingInfo.buildingIndex))
                {
                    BuldingObjDataDic[buildingInfo.buildingIndex].SetGameObject (m_buildObjDic[buildingInfo.buildingIndex]);
                }
            }
            else
            {
                BuldingObjDataDic[buildingInfo.buildingIndex].SetBuildingInfoEntity(buildingInfo);
                BuldingObjDataDic[buildingInfo.buildingIndex].SetBuildingLevelData(BuildingLevelDataBylevel(buildingInfo.type, buildingInfo.level));
             
            }
         
            if (buildingInfo.type == (int)EnumCityBuildingType.TownCenter)
            {
                m_buildingCountLimitList.ForEach((buildingCountLimit) =>
                {
                    if (buildingCountLimit.townLevel == buildingInfo.level)
                    {
                        if (!m_maxCountCurrentLevel.ContainsKey(buildingCountLimit.buildType))
                        {
                            m_maxCountCurrentLevel.Add(buildingCountLimit.buildType, buildingCountLimit.buildCountLimit);
                        }
                        else
                        {
                            m_maxCountCurrentLevel[buildingCountLimit.buildType] = buildingCountLimit.buildCountLimit;
                        }
                    }
                });
            }
            else if (buildingInfo.type == (int)EnumCityBuildingType.CityWall)
            {
                MyCityObjData.lostHp = (buildingInfo.lostHp != 0);
              //  Debug.LogErrorFormat("{0},,{1},,,,{2},,,{3}", buildingInfo.beginBurnTime, buildingInfo.lostHp, buildingInfo.serviceTime, buildingInfo.lostHp);  
            }
        }
        public void CreteCityData()
        {
            if (m_playerProxy == null)
            {
                m_playerProxy = AppFacade.GetInstance().RetrieveProxy(PlayerProxy.ProxyNAME) as PlayerProxy;
            }
            if (m_workerProxy == null)
            {
                m_workerProxy = AppFacade.GetInstance().RetrieveProxy(WorkerProxy.ProxyNAME) as WorkerProxy;
            }


        }
        private void InitData()
        {
            CityObjData cityObjData;
            rid = m_playerProxy.CurrentRoleInfo.rid;
            if (!OtherCityDic.TryGetValue(rid, out cityObjData))
            {
                cityObjData = new CityObjData();
                OtherCityDic.Add(rid, cityObjData);
            }
            cityObjData.AgeType = GetAgeType();
            cityObjData.rid = rid;
            cityObjData.lv = (int)m_playerProxy.CurrentRoleInfo.level;
            cityObjData.pos = new Vector2(m_playerProxy.CurrentRoleInfo.pos.x/100f, m_playerProxy.CurrentRoleInfo.pos.y/100f);
            cityObjData.ProvinceName = MapManager.Instance().GetMapProvinceName(cityObjData.pos);
            cityObjData.cityColor = RS.buildGreen;
            cityObjData.troopColor = RS.blue_troop;
            cityObjData.InitData();
            BuldingObjDataDic = cityObjData.buildingList;
            BuildingListByType = cityObjData.buildingListByType;
            m_cityBuildingInfoDic.Values.ToList().ForEach(((buildingInfo) => {
                if (!m_maxBuildingInfoDic.ContainsKey(buildingInfo.type))
                {
                    m_maxBuildingInfoDic.Add(buildingInfo.type, buildingInfo);
                }
                else
                {
                    if (m_maxBuildingInfoDic[buildingInfo.type].level < buildingInfo.level)
                    {
                        m_maxBuildingInfoDic[buildingInfo.type] = buildingInfo;
                    }
                }

                if (!m_minBuildingInfoDic.ContainsKey(buildingInfo.type))
                {
                    m_minBuildingInfoDic.Add(buildingInfo.type, buildingInfo);
                }
                else
                {
                    if (m_minBuildingInfoDic[buildingInfo.type].level > buildingInfo.level)
                    {
                        m_minBuildingInfoDic[buildingInfo.type] = buildingInfo;
                    }
                }
                if (!BuldingObjDataDic.ContainsKey(buildingInfo.buildingIndex))
                {
                    BuldingObjData BuldingObjData = new BuldingObjData();
                    BuldingObjData.index = buildingInfo.buildingIndex;
                    BuldingObjData.assetReady = false;
                    BuldingObjData.SetBuildingTypeConfig(m_buildingTypeConfigDic[(EnumCityBuildingType)buildingInfo.type]);
                    BuldingObjData.SetBuildingInfoEntity(buildingInfo);
                    BuldingObjData.curmodelId = GetModelIdByType(buildingInfo.type);
                    BuldingObjData.SetBuildingLevelData ( BuildingLevelDataBylevel(buildingInfo.type, buildingInfo.level));
                    MyCityObjData.AddBuilding(BuldingObjData);
                    if (buildingInfo.type == (int)EnumCityBuildingType.CityWall)
                    {
                        MyCityObjData.lostHp = (buildingInfo.lostHp != 0);
                    //   Debug.LogErrorFormat("{0},,{1},,,,{2}", buildingInfo.beginBurnTime, buildingInfo.lostHp, buildingInfo.serviceTime);
                    }
                }
                else
                {
                    BuldingObjDataDic[buildingInfo.buildingIndex].level = (int)buildingInfo.level;
                    BuldingObjDataDic[buildingInfo.buildingIndex].buildingLevelDataDefine = BuildingLevelDataBylevel(buildingInfo.type, buildingInfo.level);
                 
                }
            }));
            m_buildingCountLimitList.ForEach((buildingCountLimit)=> {
                if (buildingCountLimit.townLevel == m_playerProxy.CurrentRoleInfo.level)
                {
                    if (!m_maxCountCurrentLevel.ContainsKey(buildingCountLimit.buildType))
                    {
                        m_maxCountCurrentLevel.Add(buildingCountLimit.buildType, buildingCountLimit.buildCountLimit);
                    }
                }
            });
        }

        public bool AgeChange
        {
            get
            {
                return m_ageChange;
            }

            set
            {
                m_ageChange = value;
            }
        }

        public Dictionary<long, GameObject> BuildObjDic
        {
            get
            {
                return m_buildObjDic;
            }
        }

        public CityObjData MyCityObjData
        {
            get
            {
                CityObjData cityObjData = null;
                 OtherCityDic.TryGetValue( rid, out cityObjData);
                return cityObjData;
            }
        }

        public bool LockMoveEvent { get => m_lockMoveEvent; set => m_lockMoveEvent = value; }
        #endregion

        // Use this for initialization
        public CityBuildingProxy(string proxyName)
            : base(proxyName)
        {

        }

        public override void OnRegister()
        {
            Debug.Log(" CityBuildingProxy register");
            m_playerProxy = AppFacade.GetInstance().RetrieveProxy(PlayerProxy.ProxyNAME) as PlayerProxy;
            m_bagProxy = AppFacade.GetInstance().RetrieveProxy(BagProxy.ProxyNAME) as BagProxy;
            m_workerProxy = AppFacade.GetInstance().RetrieveProxy(WorkerProxy.ProxyNAME) as WorkerProxy;
            SetBuildingInfo();
        }


        public override void OnRemove()
        {
            Debug.Log(" CityBuildingProxy remove");
        }


        public GameObject GetBuildObjByID(long id)
        {
            GameObject build = null;

            m_buildObjDic.TryGetValue(id, out build);
            return build;
        }


        public void AddBuild(BuildingInfoEntity temp,GameObject obj)
        {
            if (!m_cityBuildingInfoDic.ContainsKey(temp.buildingIndex))
            {
                m_cityBuildingInfoDic.Add(temp.buildingIndex,temp);
            }
            if (!m_buildObjDic.ContainsKey(temp.buildingIndex))
            {
                m_buildObjDic.Add(temp.buildingIndex, obj);
            }

            BuldingObjData ObjData = null;
            if (BuldingObjDataDic.TryGetValue(temp.buildingIndex, out ObjData))
            {
                ObjData.SetGameObject(obj);
                ObjData.index = temp.buildingIndex;
                ObjData.isGameObjectLoading = false;
                ObjData.isSelected = false;
                ObjData.isUp = false;
                ObjData.level = (int)temp.level;
                ObjData.name = LanguageUtils.getText(ObjData.buildingTypeConfigDefine.l_nameId);
                ObjData.selectedCollider = string.Empty;
                ObjData.t_effects = new List<Transform>();
                List<Transform> list = ClientUtils.FindDeepMulChild(obj, "fireeffect");

                if (ObjData.type == EnumCityBuildingType.CityWall)
                {
                    {
                        Transform transform = ClientUtils.FindDeepChild(obj, "city_wall_fire_0");
                        if (transform != null)
                        {
                            ObjData.t_effects.Add(transform);
                        }
                    }
                    {
                        Transform transform = ClientUtils.FindDeepChild(obj, "city_wall_fire_1");
                        if (transform != null)
                        {
                            ObjData.t_effects.Add(transform);
                        }
                    }
                    {
                        Transform transform = ClientUtils.FindDeepChild(obj, "city_wall_fire_2");
                        if (transform != null)
                        {
                            ObjData.t_effects.Add(transform);
                        }
                    }
                    {
                        Transform transform = ClientUtils.FindDeepChild(obj, "city_wall_fire_3");
                        if (transform != null)
                        {
                            ObjData.t_effects.Add(transform);
                        }
                    }
                    {
                        Transform transform = ClientUtils.FindDeepChild(obj, "city_wall_fire_4");
                        if (transform != null)
                        {
                            ObjData.t_effects.Add(transform);
                        }
                    }
                    {
                        Transform transform = ClientUtils.FindDeepChild(obj, "city_wall_fire_5");
                        if (transform != null)
                        {
                            ObjData.t_effects.Add(transform);
                        }
                    }
                }
                else
                {
                    if (list.Count == 0)
                    {
                        ObjData.t_effects.Add(obj.transform);
                    }
                }
                list.ForEach((tr) =>
                {
                    ObjData.t_effects.Add(tr);
                });

            }
            else
            {
                TownBuilding cityBuildingHelper = obj.GetComponentInChildren<TownBuilding>();
                if (cityBuildingHelper != null)
                    cityBuildingHelper.SetColor(RS.buildGreen);
            }
        }

        public void RemoveBuild(BuildingInfoEntity temp)
        {
            bool isremove = m_cityBuildingInfoDic.Remove(temp.buildingIndex);
            bool isremoveobj = m_buildObjDic.Remove(temp.buildingIndex);
            Debug.Log(isremove +" RemoveBuild "+ isremoveobj);
        }

        public void RemoveAllBuildGameObject()
        {
            m_buildObjDic.Clear();
            FollowGameObject = string.Empty;
        }
        public void RemoveBuildGameObject(long buildingindex)
        {
            m_buildObjDic.Remove(buildingindex);
        }
        #region CityObjData BuldingObjData
        public void RemoveCity(long rid)
        {
            OtherCityDic.Remove(rid);
        }
        public void RefOtherCityDic(MapObjectInfoEntity mapObjectExtEntity)
        {
            if (mapObjectExtEntity.objectType == (long)RssType.City)
            {
                CityObjData cityObjData;

                if (!OtherCityDic.TryGetValue(mapObjectExtEntity.cityRid, out cityObjData))
                {
                    cityObjData = new CityObjData();
                    OtherCityDic.Add(mapObjectExtEntity.cityRid, cityObjData);
                }
                cityObjData.mapObjectExtEntity = mapObjectExtEntity;
                cityObjData.AgeType = GetAgeType(mapObjectExtEntity.cityLevel);
                cityObjData.rid = mapObjectExtEntity.cityRid;
                cityObjData.lv = (int)mapObjectExtEntity.cityLevel;
                SetColor(cityObjData);
                cityObjData.InitData();
                if (mapObjectExtEntity.cityRid != m_playerProxy.CurrentRoleInfo.rid)
                {
                    cityObjData.pos = new Vector2(mapObjectExtEntity.objectPos.x / 100f, mapObjectExtEntity.objectPos.y / 100f);
                    cityObjData.ProvinceName = MapManager.Instance().GetMapProvinceName(cityObjData.pos);
                     AppFacade.GetInstance().SendNotification(CmdConstant.CreateotherCity, cityObjData);
         
                }
                else
                {
                    if (cityObjData.go != null && !cityObjData.assetLoading)
                    {
                        cityObjData.mapObjectExtEntity.gameobject = cityObjData.go;
                    }
                }
                if ( ServerTimeModule.Instance.GetServerTime() -mapObjectExtEntity.beginBurnTime > 30 * 60|| mapObjectExtEntity.beginBurnTime ==-1|| mapObjectExtEntity.beginBurnTime == 0)
                {
                    cityObjData.fireState = FireState.NONE;
                    List<BuldingObjData> allList = cityObjData.buildingList.Values.ToList();
                    allList.ForEach((buldingObj) =>
                    {
                        if (buldingObj.type == EnumCityBuildingType.CityWall )
                        {
                            buldingObj.SetfireState(FireState.NONE);
                        }
                    });
                }
                else
                {
                    cityObjData.fireState = FireState.FIRED;
                    List<BuldingObjData> allList = cityObjData.buildingList.Values.ToList();
                    allList.ForEach((buldingObj) =>
                    {
                        //if (buldingObj.type != EnumCityBuildingType.CityWall )
                        //{
                        //    buldingObj.SetfireState(FireState.NONE);
                        //}
                    });
                }
                //    Debug.LogErrorFormat("FireState{0},,,{1},,,,,{2}", cityObjData.fireState, mapObjectExtEntity.cityRid, mapObjectExtEntity.beginBurnTime);

            }
        }

        public CityObjData GetCityObjData(long rid)
        {
            CityObjData cityObjData = null;
            OtherCityDic.TryGetValue(rid, out cityObjData);
            return cityObjData;
        }

        public BuldingObjData GetBuldingObjDataByIndex(long index)
        {
            BuldingObjData buldingObjData = null;
            BuldingObjDataDic.TryGetValue(index, out buldingObjData);
            return buldingObjData;
        }
        public List<BuldingObjData> GetAllBuldingObjData()
        {
            return BuldingObjDataDic.Values.ToList();
        }
        public BuldingObjData GetBuldingObjDataByType(EnumCityBuildingType type)
        {
            BuldingObjData buldingObjData = null;
            Dictionary<long, BuldingObjData> buldingObjDatadList = null;
            BuildingListByType.TryGetValue(type, out buldingObjDatadList);
            if (buldingObjDatadList != null)
            {
                buldingObjData = buldingObjDatadList.Values.ToList() [0];
            }
            return buldingObjData;
        }
        /// <summary>
        /// 更新其他人的城市和建筑信息
        /// </summary>
        /// <param name="rid"></param>
        /// <param name="buildingInfos"></param>
        public void UpdateOtherBuildingInfo(long rid, Dictionary<long, BuildingInfo> buildingInfos)
        {
            foreach (var buildingInfo in buildingInfos.Values)
            {
                CityObjData cityObjData = null;
                cityObjData = GetCityObjData(rid);
                if (cityObjData != null)
                {
                    BuldingObjData buldingObjData = cityObjData.GetBuldingObjData(buildingInfo.buildingIndex);
                    if (buldingObjData == null)
                    {
                        buldingObjData = new BuldingObjData();
                        buldingObjData.index = buildingInfo.buildingIndex;
                        buldingObjData.type = (EnumCityBuildingType)buildingInfo.type;

                        cityObjData.AddBuilding(buldingObjData);

                    }
                    buldingObjData.buildingInfo = buildingInfo;
                    buldingObjData.SetBuildingTypeConfig(m_buildingTypeConfigDic[(EnumCityBuildingType)buildingInfo.type]);
                    BuildingInfoEntity buildingInfoEntity = new BuildingInfoEntity();
                    BuildingInfoEntity.updateEntity(buildingInfoEntity, buldingObjData.buildingInfo, true);
                    buldingObjData.SetBuildingInfoEntity(buildingInfoEntity);
                    buldingObjData.SetBuildingLevelData(BuildingLevelDataBylevel(buildingInfo.type, buildingInfo.level));

                    buldingObjData.curmodelId = GetModelIdByType(buildingInfo.type, cityObjData.mapObjectExtEntity.cityCountry, cityObjData.AgeType);
                    buldingObjData.isGameObjectLoading = false;
                }
            }
            AppFacade.GetInstance().SendNotification(CmdConstant.OtherBuildingChange, rid);
        }

        #endregion
        public long GenServerBuildIndexID()
        {
            for (long i = 100; i < 200; i++)
            {
                if (!m_cityBuildingInfoDic.ContainsKey(i))
                {
                    return i;
                }
            }

            return 0L;
        }
        public bool HasType2Buff(long rid)
        {
            CityObjData cityObjData = GetCityObjData(rid);
          bool  type2Buff = false;
            if (cityObjData != null)
            {
                if (cityObjData.mapObjectExtEntity.cityBuff != null)
                {
                    foreach (var cityBuff in cityObjData.mapObjectExtEntity.cityBuff.Values)
                    {
                        CityBuffDefine cityBuffDefine = CoreUtils.dataService.QueryRecord<CityBuffDefine>((int)cityBuff.id);
                        if (cityBuff.expiredTime != -2)
                        {
                            if (cityBuffDefine.type == 2)
                            {
                                type2Buff = true;
                                break;
                            }
                        }
                    }
                }
            }
            return type2Buff;
        }

        public void UpdateCityBuildInfo(INotification notification)
        {
            Build_BuildingInfo.request CityBuildInfos = notification.Body as Build_BuildingInfo.request;

            if (CityBuildInfos == null || CityBuildInfos.buildingInfo == null)
            {
                return;
            }
            m_cityBuildChangeList.Clear();

            foreach (var buildingInfo in CityBuildInfos.buildingInfo.Values)
            {
           //     Debug.LogErrorFormat("{0},,", buildingInfo.HasBeginBurnTime);
           //     Debug.LogErrorFormat("{0},,{1},,,,{2}", buildingInfo.beginBurnTime, buildingInfo.lostHp, buildingInfo.serviceTime);
                BuildingInfoEntity buildingInfoEntity = new BuildingInfoEntity();
                if (!m_cityBuildingInfoDic.ContainsKey(buildingInfo.buildingIndex))
                {
                    m_cityBuildingInfoDic.Add(buildingInfo.buildingIndex, buildingInfoEntity);
                }
                else
                {
                    buildingInfoEntity = m_cityBuildingInfoDic[buildingInfo.buildingIndex];
                }
                m_cityBuildChangeList.Add(buildingInfoEntity);
                if (!m_isFirstGetBuildInfo)
                {
                    if (!m_resetData)
                    {
                        if (buildingInfo.HasFinishTime && buildingInfo.finishTime != -1 && buildingInfo.level == 0 && buildingInfoEntity.finishTime == 0)//开始建造
                        {
                            RemoveTempBuilding(buildingInfo.buildingIndex);
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                            AppFacade.GetInstance().SendNotification(CmdConstant.CityBuildingStart, buildingInfo.buildingIndex);
                            Debug.Log("开始建造" + buildingInfoEntity.type);
                        }
                        else if (buildingInfo.HasFinishTime && buildingInfo.finishTime != -1 && buildingInfo.level > 0 && buildingInfoEntity.level == buildingInfo.level)//开始升级
                        {
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                            AppFacade.GetInstance().SendNotification(CmdConstant.CityBuildingLevelUPStart, buildingInfo.buildingIndex);
                            Debug.Log("开始升级" + buildingInfoEntity.type);
                        }
                        else if (buildingInfo.HasFinishTime && buildingInfo.finishTime == -1 && buildingInfo.level == 1 && buildingInfoEntity.finishTime == 0)//没有建造时间的建筑开始建造
                        {
                            RemoveTempBuilding(buildingInfo.buildingIndex);
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                            AppFacade.GetInstance().SendNotification(CmdConstant.CityBuildingStart, buildingInfo.buildingIndex);
                            Debug.Log("开始建造" + buildingInfoEntity.type);
                        }
                        else if (buildingInfo.HasLevel && buildingInfo.HasFinishTime && buildingInfo.level > buildingInfoEntity.level && buildingInfo.finishTime == -1)
                        {
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                            AppFacade.GetInstance().SendNotification(CmdConstant.CityBuildingLevelUP, buildingInfo.buildingIndex);
                            if (buildingInfoEntity.type == (long)EnumCityBuildingType.TownCenter)
                            {
                                AppFacade.GetInstance().SendNotification(CmdConstant.EventTracking, new EventTrackingData(EnumEventTracking.LevelAchieved, buildingInfoEntity.level.ToString()));
                            }
                            Debug.Log("建造完成" + buildingInfoEntity.type);
                        }
                        else if (buildingInfo.HasLevel && buildingInfo.HasFinishTime && buildingInfo.level == buildingInfoEntity.level && buildingInfo.finishTime == -1&& buildingInfoEntity.finishTime>0)
                        {
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                            AppFacade.GetInstance().SendNotification(CmdConstant.CityBuildingLevelUPCancel, buildingInfo.buildingIndex);
                            Debug.Log("退出升级" + buildingInfoEntity.type);
                        }
                        else if (buildingInfo.HasLevel && buildingInfo.level == -1)
                        {
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                            Debug.Log("退出建造" + buildingInfoEntity.type);
                        }
                        else
                        {
                            UpdateEntity(buildingInfoEntity, buildingInfo);
                        }
                    }
                }
                HashSet<string> changeAttr = BuildingInfoEntity.updateEntity(buildingInfoEntity, buildingInfo, true);
                if (buildingInfoEntity.buildingGainInfo == null)
                {
                    buildingInfoEntity.buildingGainInfo = new BuildingGainInfo();
                }
                if ((buildingInfoEntity.level == 0 || buildingInfoEntity.level == -1) && buildingInfoEntity.finishTime == 0)
                {
                    if (m_cityBuildingInfoDic.ContainsKey(buildingInfoEntity.buildingIndex))
                    {
                        BuldingObjDataDic.Remove(buildingInfoEntity.buildingIndex);
                        m_cityBuildingInfoDic.Remove(buildingInfoEntity.buildingIndex);
                        continue;
                    }
                }
                if ((buildingInfoEntity.level == -1) && CanRemoveBuildType(buildingInfoEntity.type))
                {
                    if (m_cityBuildingInfoDic.ContainsKey(buildingInfo.buildingIndex))
                    {
                        BuldingObjDataDic.Remove(buildingInfoEntity.buildingIndex);
                        m_cityBuildingInfoDic.Remove(buildingInfo.buildingIndex);
                        continue;
                    }
                }
            }
            if (m_cityBuildChangeList.Count == 0)
            {
                return;
            }
           // UpdateHasBuildPos();
            if (m_isFirstGetBuildInfo)
            {
                m_isFirstGetBuildInfo = false;
                InitData();
            }
            AppFacade.GetInstance().SendNotification(CmdConstant.CityBuildinginfoChange, m_cityBuildChangeList);
            if (m_resetData)
            {
                m_resetData = false;
            }
            BuildingResourcesProxy rssProxy = AppFacade.GetInstance().RetrieveProxy(BuildingResourcesProxy.ProxyNAME) as BuildingResourcesProxy;
            if(rssProxy!=null)
            {
                rssProxy.UpdateBuilding();
            }
        }
        /// <summary>
        /// 用正式数据替换临时数据
        /// </summary>
        private void RemoveTempBuilding(long index)
        {
            long key = 0;
            foreach (var buildingInfoEntity in m_cityBuildingInfoDic)
            {
                if (( buildingInfoEntity.Value.level == 1) && buildingInfoEntity.Value.finishTime == 0)
                {
                    key = buildingInfoEntity.Key;
                }
            }
            m_cityBuildingInfoDic.Remove(key);
            GameObject obj;
            if (m_buildObjDic.TryGetValue(key,out obj))
            {
                m_buildObjDic.Add(index,obj);
                m_buildObjDic.Remove(key);
            }

          //  Debug.Log();
        }
        private void UpdateEntity(BuildingInfoEntity buildingInfoEntity , BuildingInfo buildingInfo)
        {
            BuildingInfoEntity.updateEntity(buildingInfoEntity, buildingInfo, true);
            if (buildingInfoEntity.buildingGainInfo == null)
            {
                buildingInfoEntity.buildingGainInfo = new BuildingGainInfo();
            }
            RefreshData(buildingInfoEntity);
        }

        public GameObject GetBuildingByName(string name,out long index)
        {
            GameObject gameObject = null;
            index = 0;
            foreach (var go in m_buildObjDic)
            {
                if (go.Value != null)
                {
                    if (string.Equals(go.Value.name, name))
                    {
                        gameObject = go.Value;
                        index = go.Key;
                        break;
                    }
                }
            }
            return gameObject;
        }


        public void SetBuildingInfo()
        {
            if (m_buildingCountLimitList.Count == 0)
            {
                m_buildingCountLimitList = CoreUtils.dataService.QueryRecords<BuildingCountLimitDefine>();
            }
            if (m_CityAgeSizeDic.Count == 0)
            {
                List<CityAgeSizeDefine> CityAgeSizeList = CoreUtils.dataService.QueryRecords<CityAgeSizeDefine>();
                CityAgeSizeList.ForEach((CityAgeSize) =>
                {
                    m_levelAgeDic.Add((long)CityAgeSize.townLevel,(EnumAgeType)CityAgeSize.age);
                    m_CityAgeSizeDic.Add((EnumAgeType)CityAgeSize.age,CityAgeSize);
                });
                EnumAgeType age = EnumAgeType.StoneAge;
                for (int i = 1; i <= MaxTownCenterLevel; i++)
                {
                    if (!m_levelAgeDic.ContainsKey(i))
                    {
                        m_levelAgeDic[i] = age;
                    }
                    else
                    {
                        age = m_levelAgeDic[i];
                    }
                }
            }
            if (m_buildingTypeConfigDic.Count == 0)
            {
                List<BuildingTypeConfigDefine> BuildingTypeConfigList = CoreUtils.dataService.QueryRecords<BuildingTypeConfigDefine>();
                BuildingTypeConfigList.ForEach((buildingTypeConfig)=>
                {
                    m_buildingTypeConfigDic.Add((EnumCityBuildingType)buildingTypeConfig.type,buildingTypeConfig);
                });
            }

            m_buildingCountLimitList.ForEach((buildingCountLimitDefine)=> {
                if (!m_maxCount.ContainsKey(buildingCountLimitDefine.buildType))
                {
                    m_maxCount.Add(buildingCountLimitDefine.buildType,buildingCountLimitDefine.buildCountLimit);
                }
                else
                {
                    if (m_maxCount[buildingCountLimitDefine.buildType] < buildingCountLimitDefine.buildCountLimit)
                    {
                        m_maxCount[buildingCountLimitDefine.buildType] = buildingCountLimitDefine.buildCountLimit;
                    }
                }
            });
        }
    
    
        /// <summary>
        /// 已达最大建造数量
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public bool IsCountLimitMax(long type)
        {
            bool isCountLimitMax = false;
            if (GetBuildCount(type) >= GetBuildCountLimit(type))
            {
                isCountLimitMax = true;
            }
            return isCountLimitMax;
        }

        /// <summary>
        /// 获取内城格子的配置信息
        /// </summary>
        /// <returns></returns>
        public int[] GetCityMapSizeByAge()
        {
//            Debug.Log("GetCityMapSizeByAge"+((int) GetAgeType()-1));
            return cityAgeSize[(int) GetAgeType()-1];
        }
        public int[] GetCityMapSizeByAge(int age)
        {
            //            Debug.Log("GetCityMapSizeByAge"+((int) GetAgeType()-1));
            return cityAgeSize[age - 1];
        }

        public List<int> GetCurmenuButtons(long index,BuildingTypeConfigDefine m_curBuildingTypeConfig)
        {
            List<int> CurmenuButtons = new List<int>();
            int length = m_curBuildingTypeConfig.menuButtons.Count;
            BuildingInfoEntity buildingInfoEntity = m_cityBuildingInfoDic[index];

            if (buildingInfoEntity.level == 0 && buildingInfoEntity.finishTime == 0) 
            {
                //零时建筑菜单  创建和取消
                CurmenuButtons.Add(2);
                CurmenuButtons.Add(1);
                return CurmenuButtons;
            }
            
            for (int i = length-1; i >=0; i--)
            {
                if (!IsShow(index,m_curBuildingTypeConfig.menuButtons[i]))
                {
                    
                }
                else
                {
                    CurmenuButtons.Add(m_curBuildingTypeConfig.menuButtons[i]);
                }
            }

            return CurmenuButtons;
        }

        /// <summary>
        /// 建筑在研究/训练/治疗
        /// </summary>
        /// <param name="index"></param>
        /// <returns></returns>
        public bool IsStudding(long index)
        {
            bool IsStudding = false;
            int state = GetTrainStatus(index);
            if (state == SoldierTrainStatus.Training)
            {
                IsStudding = true;
            }
            long serverTime = ServerTimeModule.Instance.GetServerTime();
            if (IsUpgrading(index))
            {
                IsStudding = false;
            }
            else
            {
                if (m_playerProxy.CurrentRoleInfo.treatmentQueue.finishTime > serverTime && CityBuildingInfoDic[index].type == (int)EnumCityBuildingType.Hospital)
                {
                    IsStudding = true;
                }
                if (m_playerProxy.CurrentRoleInfo.technologyQueue.finishTime > serverTime && CityBuildingInfoDic[index].type == (int)EnumCityBuildingType.Academy)
                {
                    IsStudding = true;
                }
            }
            return IsStudding;
        }

        /// <summary>
        /// 获取训练状态
        /// </summary>
        /// <param name="index"></param>
        /// <returns></returns>
        public int GetTrainStatus(Int64 buildingIndex)
        {
            if (m_playerProxy.TrainQueueMap.ContainsKey(buildingIndex))
            {
                Int64 serverTime = ServerTimeModule.Instance.GetServerTime();
                if (m_playerProxy.TrainQueueMap[buildingIndex].finishTime < 0)
                {
                    return SoldierTrainStatus.None;
                }
                else if (m_playerProxy.TrainQueueMap[buildingIndex].finishTime > serverTime)
                {
                    return SoldierTrainStatus.Training;
                }
                else if (m_playerProxy.TrainQueueMap[buildingIndex].finishTime <= serverTime)
                {
                    return SoldierTrainStatus.Finished;
                }
            }
            return SoldierTrainStatus.None;
        }

        /// <summary>
        /// 建筑是否在建造/升级
        /// </summary>
        /// <param name="index"></param>
        /// <returns></returns>
        public bool IsUpgrading(long index)
        {
            bool Isupgrading = false;
            BuildingInfoEntity buildingInfoEntity = null;
            if(m_cityBuildingInfoDic.TryGetValue(index,out buildingInfoEntity ))
                {
                if (buildingInfoEntity.finishTime != -1)
                {
                    Isupgrading = true;
                }
            }
            return Isupgrading;
        }
        /// <summary>
        /// 建筑菜单是否显示
        /// </summary>
        /// <param name="index"></param>
        /// <returns></returns>
        private bool IsShow(long index,int menudata)
        {
            bool Show = false;
            BuildingMenuDataDefine BuildingMenuData = CoreUtils.dataService.QueryRecord<BuildingMenuDataDefine>(menudata);
            BuildingInfoEntity buildingInfoEntity = m_cityBuildingInfoDic[index];
            if (buildingInfoEntity.level >= BuildingMenuData.showLevelMin && buildingInfoEntity.level <= BuildingMenuData.showLevelMax)
            {

            }
            else
            {
                Show = false;
                return Show;
            }
            if (IsUpgrading(index))
            {
                if (BuildingMenuData.showType2 == 0)
                {
                    Show = true;
                    return Show;
                }
            }
            if (IsStudding(index))
            {
                if (BuildingMenuData.showType3 == 0)
                {
                    Show = true;
                    return Show;
                }
            }

            if ( !(IsUpgrading(index)) && !IsStudding(index)&& (BuildingMenuData.showType1 == 0))
            {
                Show = true;
                return Show;
            }
            return Show;
        }

        public BuildingInfoEntity GetBuildingInfoByindex(long index)
        {
            if (!m_cityBuildingInfoDic.ContainsKey(index))
            {
                return null;
            }
            return m_cityBuildingInfoDic[index];
        }
        /// <summary>
        /// 获取当前可建造的经济或军事类建筑
        /// </summary>
        /// <returns></returns>
        public bool TryBuildableType(out int cityBuildingType)
        {
            bool buildable = false;
             cityBuildingType = 0;
            List<BuildingTypeConfigDefine> buildingTypeConfigList = CoreUtils.dataService.QueryRecords<BuildingTypeConfigDefine>();
            List<BuildingTypeConfigDefine> m_jingjiBuildList = new List<BuildingTypeConfigDefine>();
            List<BuildingTypeConfigDefine> m_junshiBuildList = new List<BuildingTypeConfigDefine>();
            for (int i = 0; i < buildingTypeConfigList.Count; i++)
            {
                BuildingTypeConfigDefine buildingTypeConfig = buildingTypeConfigList[i];
                EnumBuildingGroupType enumBuildingGroupType = (EnumBuildingGroupType)buildingTypeConfig.group;
                switch (enumBuildingGroupType)
                {
                    case EnumBuildingGroupType.Economic:
                        m_jingjiBuildList.Add(buildingTypeConfig);
                        break;
                    case EnumBuildingGroupType.Military:
                        m_junshiBuildList.Add(buildingTypeConfig);
                        break;
                    case EnumBuildingGroupType.Decorative:
                        break;
                    case EnumBuildingGroupType.NON:
                        break;
                    default:
                        break;
                }
            }
            m_jingjiBuildList.Sort((BuildingTypeConfigDefine x , BuildingTypeConfigDefine y) =>x.type.CompareTo(y.type));
            m_junshiBuildList.Sort((BuildingTypeConfigDefine x , BuildingTypeConfigDefine y) =>x.type.CompareTo(y.type));
            for (int i = 0; i < m_jingjiBuildList.Count; i++)
            {
                BuildingTypeConfigDefine buildingTypeConfigDefine = m_jingjiBuildList[i];
                BuildCityType buildCityType = GetBuildCityType(buildingTypeConfigDefine.type);
                if (buildCityType == BuildCityType.Buildable)
                { 
                        buildable = true;
                    cityBuildingType = buildingTypeConfigDefine.type;
                    break;
                }
            }
            if(!buildable)
            {
                for (int i = 0; i < m_junshiBuildList.Count; i++)
                {
                    BuildingTypeConfigDefine buildingTypeConfigDefine = m_junshiBuildList[i];
                    BuildCityType buildCityType = GetBuildCityType(buildingTypeConfigDefine.type);
                    if (buildCityType == BuildCityType.Buildable)
                    {
                        buildable = true;
                        cityBuildingType = buildingTypeConfigDefine.type;
                    }
                }
            }
            return buildable;
        }
        /// <summary>
        /// 获取等级最小的可升级的建筑信息
        /// </summary>
        /// <returns></returns>
        public BuildingInfoEntity GetBuildingInfominlevel()
        {
            BuildingInfoEntity buildingInfo = new BuildingInfoEntity();
            long minlevel = 100;
            foreach(var value in BuldingObjDataDic.Values)       
            {
                if (CanUpGradeBuild(value))
                {
                    if (value.level < minlevel)
                    {
                        minlevel = value.level;
                        buildingInfo = value.buildingInfoEntity;
                    }
                    else if (value.level == minlevel)
                    {
                        if (value.buildingInfoEntity.type < buildingInfo.type)
                        {
                            buildingInfo = value.buildingInfoEntity;
                        }
                    }

                }            }
            return buildingInfo;
        }
        public long GetMaxLevelofType(long type)
        {
            long maxLevel = 0;
            if (type == 0)
            {

            }
            else
            {
                BuildingInfoEntity maxLevelInfo = null;
                if (m_maxBuildingInfoDic.TryGetValue(type, out maxLevelInfo))
                {
                    maxLevel = maxLevelInfo.level;
                }
            }
        
            return maxLevel;
        }
        /// <summary>
        /// 返回最大
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public BuildingInfoEntity GetBuildingInfoByType(long type)
        {
            BuildingInfoEntity buildingInfo = null;
            if (m_maxBuildingInfoDic.TryGetValue(type,out buildingInfo))
            {

            }
            return buildingInfo;
        }

        public List<BuildingInfoEntity> GetTrainBuilds()
        {
            List<BuildingInfoEntity> builds = new List<BuildingInfoEntity>();
            foreach (var value in m_cityBuildingInfoDic)
            {
                if (IsTranBuild(value.Value.type))
                {
                    builds.Add(value.Value);
                }
            }

            return builds;
        }

        public bool IsTranBuild(long type)
        {
            if (type>=(int)EnumCityBuildingType.Barracks && type<=(int)EnumCityBuildingType.SiegeWorkshop)
            {
                return true;
            }

            return false;
        }

        /// <summary>
        /// 返回最小
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public BuildingInfoEntity GetMinBuildingInfoByType(long type)
        {
            BuildingInfoEntity buildingInfo = null;
            if (m_minBuildingInfoDic.TryGetValue(type,out buildingInfo))
            {

            }
            return buildingInfo;
        }
        /// <summary>
        /// 返回所有
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public List<BuildingInfoEntity> GetAllBuildingInfoByType(long type)
        {
            List<BuildingInfoEntity> buildingInfos = new List<BuildingInfoEntity>();
            foreach (var value in m_cityBuildingInfoDic.Values)

            {
                if (value.type == type)
                {
                    buildingInfos.Add(value);
                }
            }
            return buildingInfos;
        }
        public List<BuildingInfoEntity> GetBuildingInfosByGroupType(long group)
        {
            List<BuildingInfoEntity> buildingInfos = new List<BuildingInfoEntity>();
            foreach (var value in m_cityBuildingInfoDic.Values)
            {
                BuildingTypeConfigDefine buildingTypeConfig = m_buildingTypeConfigDic[(EnumCityBuildingType)value.type]; 
                if (buildingTypeConfig.group == group)
                {
                    buildingInfos.Add(value);
                }
            }
            return buildingInfos;
        }
        /// <summary>
        /// 
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public BuildingTypeConfigDefine GetBuildingTypeConfigByType(EnumCityBuildingType type)
        {
            BuildingTypeConfigDefine buildingTypeConfig = null;
            m_buildingTypeConfigDic.TryGetValue(type,out buildingTypeConfig);
              return buildingTypeConfig;
        }


        public void BuildMove(long id,int logicX,int logicY)
        {
            Build_RemoveBuilding.request req = new Build_RemoveBuilding.request();
            req.buildingIndexs = id;
            req.pos = new PosInfo();
            req.pos.x = logicX;
            req.pos.y = logicY;
            
            Debug.LogFormat("建筑移动rid:{0}  x:{1} y:{2}",id,logicX,logicY);
            
            AppFacade.GetInstance().SendSproto(req);
        }

        public string GetModelIdByType(long type)
        {
            string modelId = string.Empty;
            string strId = string.Empty;
            if (AgeChange)
            {
                 strId = string.Format("{0}{1}{2}",type,m_playerProxy.GetCivilization(),(int)GetAgeType()-1);            
            }
            else
            {
                strId = string.Format("{0}{1}{2}",type,m_playerProxy.GetCivilization(),(int)GetAgeType());
            }
            int id = int.Parse(strId);
            BuildingModelDataDefine modelDefine = CoreUtils.dataService.QueryRecord<BuildingModelDataDefine>(id);
            if (modelDefine != null)
            {
                modelId = modelDefine.modelId;
            }
            else
            {
                
            }
            return modelId;
        }
        public string GetModelIdByType( long type,long Civilization,EnumAgeType AgeTyp)
        {
            string modelId = string.Empty;
            //modelId = string.Format("build_{0}_101_{1}",type,(int)GetAgeType());
            string strId = string.Format("{0}{1}{2}",type,Civilization,(int)AgeTyp);
            int id = int.Parse(strId);
            BuildingModelDataDefine modelDefine = CoreUtils.dataService.QueryRecord<BuildingModelDataDefine>(id);
            if (modelDefine != null)
            {
                modelId = modelDefine.modelId;
            }
            return modelId;
        }

        public string GetImgIdByType(long type)
        {
            string imgId = string.Empty;
            string strId = string.Format("{0}{1}{2}",type,m_playerProxy.GetCivilization(),(int)GetAgeType());
            int id = int.Parse(strId);
            BuildingModelDataDefine modelDefine = CoreUtils.dataService.QueryRecord<BuildingModelDataDefine>(id);
            if (modelDefine != null)
            {
                imgId = modelDefine.imgRes;
            }
            return imgId;
        }
        public int GetprioritydByType(long type)
        {
            int priority = 0;
            EnumCityBuildingType enumCityBuildingType = (EnumCityBuildingType)(type);
            switch (enumCityBuildingType)
            {
                case EnumCityBuildingType.TownCenter:
                    priority = 101;
                    break;
                case EnumCityBuildingType.CityWall:
                    priority = 98;
                    break;
                default:
                    priority = 97;
                    break;
            }
            // string modelId =  Enum.GetName(typeof(EnumCityBuildingType),type);           
            return priority;
        }

        public bool CanUpGradeBuildType(long type)
        {
            bool CanUpGrade = true;
            EnumCityBuildingType enumCityBuildingType = (EnumCityBuildingType)(type);
            switch (enumCityBuildingType)
            {
                case EnumCityBuildingType.BuilderHut:
                case EnumCityBuildingType.CourierStation:
                case EnumCityBuildingType.Market:
                case EnumCityBuildingType.BulletinBoard:
                case EnumCityBuildingType.Monument:
                case EnumCityBuildingType.Smithy:
                case EnumCityBuildingType.tree:
                case EnumCityBuildingType.tree2:
                case EnumCityBuildingType.tree3:
                case EnumCityBuildingType.tree4:
                case EnumCityBuildingType.Road:
                    {
                        CanUpGrade = false;
                    }
                    break;
            }
            return CanUpGrade;
        }


        public bool CanUpGradeBuild(BuldingObjData buldingObjData)
        {
            bool CanUpGrade = false;
            EnumCityBuildingType enumCityBuildingType = buldingObjData.type;

            BuildingTypeConfigDefine  buildingTypeConfigDefine = buldingObjData.buildingTypeConfigDefine;

                List<int> menuButtons = buildingTypeConfigDefine.menuButtons;
                for (int i = 0; i < menuButtons.Count; i++)
                {
                    BuildingMenuDataDefine BuildingMenuData = CoreUtils.dataService.QueryRecord<BuildingMenuDataDefine>(menuButtons[i]);
                    if (string.Equals(BuildingMenuData.func,"openBuildingUpdata") || string.Equals(BuildingMenuData.func,"openBuildingUpdataAge"))
                    {
                    if (IsShow(buldingObjData.index,menuButtons[i]))
                    {
                        CanUpGrade = true;
                    }
                    }
                }
            
            return CanUpGrade;
        }

        /// <summary>
        /// 能铲除的建筑类型
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public bool CanRemoveBuildType(long type)
        {
            bool CanRemove = false;
            BuildingTypeConfigDefine buildingTypeConfigDefine = m_buildingTypeConfigDic[(EnumCityBuildingType)type];
            if (buildingTypeConfigDefine != null)
            {
                CanRemove = buildingTypeConfigDefine.group == (int)EnumBuildingGroupType.Decorative;
            }
            return CanRemove;
        }

        public BuildingLevelDataDefine BuildingLevelDataBylevel(long type,long level = 1)
        {
            BuildingLevelDataDefine buildingLevelDataDefine = null;
            buildingLevelDataDefine = CoreUtils.dataService.QueryRecord<BuildingLevelDataDefine>((int)(type * 100 + level));
            return buildingLevelDataDefine;
        }
        public BuildingLevelDataDefine BuildingLevelDataByinfo(BuildingInfoEntity info)
        {
            BuildingLevelDataDefine buildingLevelDataDefine = null;

            BuldingObjData buldingObjData = null;
            if (BuldingObjDataDic.TryGetValue(info.buildingIndex,out buldingObjData))
            {
                buildingLevelDataDefine = buldingObjData.buildingLevelDataDefine;
            }

            return buildingLevelDataDefine;
        }

        public EnumAgeType GetAgeType(long level = 0)
        {
            EnumAgeType enumAgeType = EnumAgeType.StoneAge;
            if (level == 0)
            {
                level = m_playerProxy.CurrentRoleInfo.level;
            }
            m_levelAgeDic.TryGetValue(level,out enumAgeType);
                
            return enumAgeType;
        }
        private void SetColor( CityObjData cityObjData)
        {
            Color color = new Color();
            Color troop_color = new Color();
            if (cityObjData.mapObjectExtEntity.cityRid == m_playerProxy.CurrentRoleInfo.rid)
            {
                OtherCityDic.Values.ToList().ForEach((temp) =>
                {
                    if (temp.mapObjectExtEntity.cityRid != m_playerProxy.CurrentRoleInfo.rid)
                    {
                        SetColor(temp);
                    }
                });
            }
            else
            {
                if (m_playerProxy.CurrentRoleInfo.guildId == 0)
                {
                    color = RS.buildRed;
                    troop_color = RS.red_troop;
                }
                else
                {
                    if (m_playerProxy.CurrentRoleInfo.guildId == cityObjData.mapObjectExtEntity.guildId)
                    {
                        color = RS.buildBlue;
                        troop_color = RS.blue_troop;
                    }
                    else
                    {
                        color = RS.buildRed;
                        troop_color = RS.red_troop;
                    }
                }
                cityObjData.cityColor = color;
                cityObjData.troopColor = troop_color;
            }
        }
        /// <summary>
        /// 获取内城
        /// </summary>
        /// <param name="enumAgeType"></param>
        /// <returns></returns>
        public CityAgeSizeDefine GetCityAgeSizeDefineByAge(EnumAgeType enumAgeType )
        {
            return m_CityAgeSizeDic[enumAgeType];
        }
        /// <summary>
        /// 获取内城尺寸
        /// </summary>
        /// <param name="enumAgeType"></param>
        /// <returns></returns>
        public int GetCityAgeSizeByAge(EnumAgeType enumAgeType)
        {
            return m_CityAgeSizeDic[enumAgeType].size;
        }
        /// <summary>
        ///  获取内城基础信息
        /// </summary>
        /// <returns></returns>
        public CityAgeSizeDefine GetCityAgeSizeDefine()
        {
            EnumAgeType enumAgeType = GetAgeType();
            if (m_CityAgeSizeDic.ContainsKey(enumAgeType))
            {
                return m_CityAgeSizeDic[enumAgeType];
            }
            return null;
        }
        /// <summary>
        ///  获取内城尺寸
        /// </summary>
        /// <returns></returns>
        public int GetCityAgeSize()
        {
            EnumAgeType enumAgeType = GetAgeType();
            return m_CityAgeSizeDic[enumAgeType].size;
        }

        public int GetCityAgeSize(long level)
        {
            EnumAgeType enumAgeType = GetAgeType(level);
            return m_CityAgeSizeDic[enumAgeType].size;
        }
        /// <summary>
        /// 获取最大内城
        /// </summary>
        /// <returns></returns>
        public int GetCityAgeMaxSize()
        {
            return m_CityAgeSizeDic[EnumAgeType.FeudalAge].size;
        }

        public bool HasBuildableBuild(EnumBuildingGroupType enumBuildingGroupType)
        {
            bool buildable = false;
          List<BuildingTypeConfigDefine>  buildingTypeConfigList = CoreUtils.dataService.QueryRecords<BuildingTypeConfigDefine>();
            buildingTypeConfigList.ForEach((buildingTypeConfig) => {
                if (!buildable)
                {
                    if (enumBuildingGroupType == (EnumBuildingGroupType)buildingTypeConfig.group)
                    {
                        BuildCityType buildCityType = GetBuildCityType(buildingTypeConfig.type);
                        if (buildCityType == BuildCityType.Buildable)
                        {
                            buildable = true;
                        }
                    }
                }
            });
            return buildable;
        }
        /// <summary>
        /// 能建造的建筑数量
        /// </summary>
        /// <param name="enumBuildingGroupType"></param>
        /// <returns></returns>
        public int CountBuildableBuild(out int countMilitary)
        {
            int countEconomic = 0;//经济
            countMilitary = 0;//军事
            int countDecorative = 0;

            List<BuildingTypeConfigDefine> buildingTypeConfigList = CoreUtils.dataService.QueryRecords<BuildingTypeConfigDefine>();
            for (int i = 0; i < buildingTypeConfigList.Count; i++)
            {
                var buildingTypeConfig = buildingTypeConfigList[i];
                BuildCityType buildCityType = GetBuildCityType(buildingTypeConfig.type);
                if (buildCityType == BuildCityType.Buildable)
                {
                    switch ((EnumBuildingGroupType)buildingTypeConfig.group)
                    {
                        case EnumBuildingGroupType.Economic:
                            countEconomic++;
                            break;
                        case EnumBuildingGroupType.Military:
                            countMilitary ++;
                            break;
                        case EnumBuildingGroupType.Decorative:
                            break;
                    }
                }
            }
            return countEconomic;
        }


        public BuildCityType GetBuildCityType(long type)
        {
            BuildCityType buildCityType;
            int buildCount = GetBuildCount(type);
            if (buildCount >= GetBuildCountLimit(type))
            {
                if (buildCount >= GetBuildCountMax(type))
                {
                    buildCityType = BuildCityType.BuildMax;
                }
                else
                {
                    buildCityType = BuildCityType.Notunlock;
                }
                }
            else
            {
                buildCityType = BuildCityType.Buildable;
            }
            return buildCityType;
        }
        /// <summary>
        /// 是否是时代下的第一级等级
        /// </summary>
        /// <param name="level"></param>
        /// <returns></returns>
        public bool NewAgeByLevel(long level)
        {
            bool NewAge = false;
            if (level == 1)
            {
                NewAge = true;
            }
            else
            {
                if (GetAgeType(level - 1) != GetAgeType(level))
                {
                    NewAge = true;
                }
            }
            return NewAge;
        }
        /// <summary>
        /// 是否是时代下的最后一等级
        /// </summary>
        /// <param name="level"></param>
        /// <returns></returns>
        public bool LastlevelOfAge(long level)
        {
            bool lastLevel = false;
                if (GetAgeType(level + 1) != GetAgeType(level))
                {
                    lastLevel = true;
                }
            
            return lastLevel;
        }

        /// <summary>
        /// 类型建筑已建造+建筑中的数量
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public int GetBuildCount(long type)
        {
            int buildCount = 0;
            m_cityBuildingInfoDic.Values.ToList().ForEach((value) =>{
                if (value.type == type && value.finishTime != 0)
                {
                    buildCount++;
                }
            });

            return buildCount;
        }
        /// <summary>
        /// 解锁建筑次数需要的市政厅等级
        /// </summary>
        /// <returns></returns>
        public int GetBuildCountNext(long type)
        {
            int townCenterLevel = 0;
            for (int i = 0; i < m_buildingCountLimitList.Count; i++)
            {
                if (m_buildingCountLimitList[i].buildType == type)
                {
                    if (m_buildingCountLimitList[i].buildCountLimit > m_maxCountCurrentLevel[type])
                    {
                        townCenterLevel = m_buildingCountLimitList[i].townLevel;
                        break;
                    }
                }
            }
            return townCenterLevel;
        }

        /// <summary>
        /// 获取当前等级下的建筑数量上限
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public int GetBuildCountLimit(long type)
        {
            int buildCountLimit = 0;
            m_maxCountCurrentLevel.TryGetValue(type,out buildCountLimit);

            return buildCountLimit;
        }
        /// <summary>
        /// 获取建筑数量上限
        /// </summary>
        /// <param name="type"></param>
        /// <returns></returns>
        public int GetBuildCountMax(long type)
        {
            int buildCountMax = 0;
            m_maxCount.TryGetValue(type,out buildCountMax);
            return buildCountMax;
        }

        /// <summary>
        /// 是否有空闲的队列
        /// </summary>
        public bool IsbuildQueueleisur(int finishTime = 0)
        {
            if (m_workerProxy == null)
            {
                m_workerProxy = AppFacade.GetInstance().RetrieveProxy(WorkerProxy.ProxyNAME) as WorkerProxy;
            }
            bool leisur = false;
            BuildQueueState mainQueueState = m_workerProxy.GetMainQueueState();
            if (mainQueueState == BuildQueueState.NOLEISURE)
            {
                BuildQueueState SecendQueueState = m_workerProxy.GetSecendQueueState(finishTime);
                if (SecendQueueState == BuildQueueState.LEISURE1)
                {
                    leisur = true;
                }
            }
            else
            {
                leisur = true;
            }
            return leisur;
        }
        /// <summary>
        /// 显示或隐藏升级石
        /// </summary>
        /// <returns></returns>
        public bool ShowUpgradeBoard(long buildingindex)
        {

            bool Show = false;
            BuildingInfoEntity buildingInfoEntity = GetBuildingInfoByindex(buildingindex);
            if (buildingInfoEntity != null)
            {
                    BuildingLevelDataDefine nextBuildingLevelDataDefine = BuildingLevelDataBylevel(buildingInfoEntity.type,buildingInfoEntity.level + 1);
                if (nextBuildingLevelDataDefine != null)
                {
                    if (m_bagProxy == null)
                    {
                        m_bagProxy = AppFacade.GetInstance().RetrieveProxy(BagProxy.ProxyNAME) as BagProxy;
                    }
                    if (GetMaxLevelofType(nextBuildingLevelDataDefine.reqType1) >= nextBuildingLevelDataDefine.reqLevel1
                        && GetMaxLevelofType(nextBuildingLevelDataDefine.reqType2) >= nextBuildingLevelDataDefine.reqLevel2
                        && GetMaxLevelofType(nextBuildingLevelDataDefine.reqType3) >= nextBuildingLevelDataDefine.reqLevel3
                        && m_playerProxy.CurrentRoleInfo.gold >= nextBuildingLevelDataDefine.coin
                        && m_playerProxy.CurrentRoleInfo.stone >= nextBuildingLevelDataDefine.stone
                        && m_playerProxy.CurrentRoleInfo.wood >= nextBuildingLevelDataDefine.wood
                        && m_playerProxy.CurrentRoleInfo.food >= nextBuildingLevelDataDefine.food
                        && m_bagProxy.GetItemNum(nextBuildingLevelDataDefine.itemType1) >= nextBuildingLevelDataDefine.itemCnt
                        && IsbuildQueueleisur(nextBuildingLevelDataDefine.buildingTime)
                        && !IsStudding(buildingInfoEntity.buildingIndex)
                        && buildingInfoEntity.finishTime == -1
                        && (buildingInfoEntity.type != (long)EnumCityBuildingType.GuardTower
                        && buildingInfoEntity.type != (long)EnumCityBuildingType.CityWall)
                        )
                    {
                        Show = true;
                    }

                }


            }

            return Show;
        }

        public void SendCreateBuild(BuildingTypeConfigDefine buildingType,PosInfo pos)
        {
            Debug.LogFormat("创建建筑 {0} pos:{1} {2} w:{3} l:{4} serverTime:{4}",buildingType.type, pos.x,pos.y,buildingType.width,buildingType.length,
                ServerTimeModule.Instance.GetServerTime());
            Build_CreateBuilding.request request = new Build_CreateBuilding.request();
            request.pos = pos;
            request.type = buildingType.type;
            AppFacade.GetInstance().SendSproto(request);
        }

        //获取建筑队列索引
        public QueueInfo GetBuildingQueue(long buildingIndex)
        {
            foreach (var element in m_playerProxy.CurrentRoleInfo.buildQueue)
            {
                if (element.Value.buildingIndex == buildingIndex)
                {
                    return element.Value;
                }
            }

            return null;
        }

        //建筑队列加速
        public void AddBuildingUpdateSpeed(BuildingInfoEntity info )
        {
            string strId = string.Format("{0}{1}{2}", info.type, m_playerProxy.GetCivilization(), (int)GetAgeType());
            int id = int.Parse(strId);
            BuildingModelDataDefine modelDefine = CoreUtils.dataService.QueryRecord<BuildingModelDataDefine>(id);

            QueueInfo queueInfo = GetBuildingQueue(info.buildingIndex);

            if (queueInfo != null)
            {
                SpeedUpData data = new SpeedUpData
                {
                    type = EnumSpeedUpType.buiding,
                    iconRes = modelDefine.imgRes,
                    queue = queueInfo,
                    cancelCallback = () =>{

                        string title = info.level == 0 ? LanguageUtils.getText(402024) : LanguageUtils.getText(402022);
                        string buildingName = string.Empty;
                        var buildingTypeCfg = CoreUtils.dataService.QueryRecord<BuildingTypeConfigDefine>((int)info.type);
                        if(buildingTypeCfg != null)
                        {
                            buildingName = LanguageUtils.getText(buildingTypeCfg.l_nameId);
                        }
                        string content = info.level == 0 ? LanguageUtils.getTextFormat(402025, buildingName) : LanguageUtils.getTextFormat(402026, buildingName);

                        Alert.CreateAlert(content, title).SetLeftButton().SetRightButton(() =>
                        {
                            Build_EndBuilding.request req = new Build_EndBuilding.request();
                            req.buildingIndex = info.buildingIndex;
                            AppFacade.GetInstance().SendSproto(req);
                            if (info.level == 0)
                            {
                                AppFacade.GetInstance().SendNotification(CmdConstant.RemoveBuildHud, info);
                                AppFacade.GetInstance().SendNotification(CmdConstant.RemoveBuild, info);
                            }
                            AppFacade.GetInstance().SendNotification(CmdConstant.CloseAddSpeed);
                        }).Show();
                    },
                };
                AppFacade.GetInstance().SendNotification(CmdConstant.SpeedUp, data);
            }
        }

        //是否正处于准备建造
        public bool IsPlaceStatus(Int64 index)
        {
            BuildingInfoEntity info = GetBuildingInfoByindex(index);
            if (info != null)
            {
                if (info.level == 0 && info.finishTime == 0)
                {
                    return true;
                }
            }
            return false;
        }
        public Color GetCivilizationColor( long Civilization, EnumAgeType age)
        {
            Color color = new Color(1, 1, 1);
            return color;
        }

        /// <summary>
        /// 自己的城市建造按照逻辑设置为着火状态，其他的城市，只有在city层级下才设置
        /// </summary>
        /// <param name="buldingObjDatas"></param>
        /// <param name="city"></param>
        public void SetFireState( List<BuldingObjData>  buldingObjDatas,bool city = true)
        {
            int count = 0;
            buldingObjDatas.ForEach((buldingObj) => {
           
                    if (buldingObj.type != EnumCityBuildingType.CityWall && buldingObj.type != EnumCityBuildingType.GuardTower && buldingObj.type < EnumCityBuildingType.Road)
                {
                    if (city)
                    {
                        if (count < m_playerProxy.ConfigDefine.buildBurnNum)
                        {
                            buldingObj.SetfireState(FireState.FIRED);
                            count++;
                        }
                        else
                        {
                            buldingObj.SetfireState(FireState.NONE);
                        }
                    }
           
                }
                else if (buldingObj.type == EnumCityBuildingType.CityWall)
                {
                    buldingObj.SetfireState(FireState.NONE);
                }

            });
        }

    public void ResetData()
        {
            m_buildObjDic.Clear();
            m_cityBuildingInfoDic.Clear();
            CityBuildingInfoDic.Clear();
            m_cityBuildChangeList.Clear();
            m_isFirstGetBuildInfo = true;
            m_followGameObject = string.Empty;
            m_resetData = true;
            OtherCityDic.Clear();
            BuldingObjDataDic.Clear();
            BuildingListByType.Clear();
        }

    }
}